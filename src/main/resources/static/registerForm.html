<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <style>
        @font-face {
        font-family: 'Pretendard-Regular';
        src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
        font-weight: 400;
        font-style: normal;
    }
    *{
        font-family: 'Pretendard-Regular';
    }
    html, body {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f5f5f5;
    }

    h1 {
        text-align: center;
        text-underline-position: below;
        /* text-shadow: #B2D055 3px 3px, #B2D055 3px 3px; */
        font-weight: bolder;
    }
    form {
        border-radius: 15px;
        padding-left: 60px;
        padding-right: 60px;
        padding-bottom: 70px;
        padding-top: 30px;
        background-color: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    #idFill, #emailFill, #pwFill{
    padding: 0;
    }

    div:nth-of-type(1) {
        width: 450px;
        padding: 1rem;
    }
    input[name = "name"] {
        margin-left: 41px;
        margin-top: 5px;
        width: 78%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        background-color: white;
    }
    input[name = "id"] {
        margin-top: 5px;
        margin-left: 27px;
        width: 52%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        background-color: white;
    }
    input[type="date"]::before{
            content: attr(data-placeholder);
            color: #BABABA;
            width: 100%
         }
    input[type = "data"]: focus::before,
    input[type = "data"]: valid::before{
    display : none;
    }
    input[type="date"]{
    position: relative;
    margin-top: 5px;
    margin-left: 10px;
    width: 78%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    background-color: white;
    }


    input[name="email"]{
        margin-top: 5px;
        margin-left: 23px;
        margin-right: 1px;
        width: 52%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        background-color: white;
        position: relative;
    }
    input[type="password"]{
        margin-top: 5px;
        margin-right: 3px;
        margin-left: 10px;
        width: 78%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        background-color: white;
    }
    .--bs-btn-hover-color{
        text-align: center;
        width: 25%;
        height: 35px;
        background-color: #B2D055;
        border: none;
        border-radius:10px;
        margin-top: 5px;
        margin-left: 1px;
        padding: 10px;
    }

.btn-bd-primary{
    text-align: center;
    width: 100%;
    margin-left: 52px;
    height: 45px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 10px;
    margin-top: 10px;
    font-size: 16px;
    letter-spacing: 1px;
    transition: all 0.3s ease-in-out;
    margin-bottom: 30px;
}

.btn-bd-primary:hover {
    background-color: black;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transform: translateY(-1px);
}

    .btn-confirm{
        text-align: center;
        margin-top: 5px;
        margin-left: 40px;
        background-color: white;
        color: black;
    }

    .btn-confirm2{
        text-align: center;
        display: inline-block;
        margin-top: 5px;
        background-color: white;
        color: black;
        margin-left: -5px;
    }

    .birth{
        box-sizing:border-box;
    }

    #text, #text1, #text2, #submitPage{
        color: #000;
        font-size: 13px;
        text-stroke: 0.3px solid #000;
        display: none;
        margin-left: 70px;
        margin-top: 4px;
    }

    .link, .link2{
        color: black;
        text-align: right;
        float: right;
        text-decoration: underline;
        text-align:right;
    }
    .link:hover{
        font-weight: bolder;
    }

    .link2:hover{
       font-weight: bolder;
    }

    </style>
</head>
<body>
<main class="form-signin w-100 m-auto">
    <form action="/register" id="form" method="POST">
        <h1>회원가입</h1><br>
        <div class="fill-in">
            <label>이름<input type="text" name="name" placeholder="(필수)" required></label><br>
            <div id="idFill">
                <label>아이디<input type="text" name="id" id="id" placeholder="(필수)" required></label>
                <button class="--bs-btn-hover-color" type="button" onclick="checkId()">아이디 확인</button>
                <br>
                <span id="text1"></span>
            </div>
            <label>성별
                <input class="btn btn-confirm" type="radio" name="gender" value="male" placeholder="남자" required>남자
                <input class="btn btn-confirm2" type="radio" name="gender" value="female"
                       placeholder="여자" required>여자</label><br>
            <label>생년월일 <input type="date" name="birth" id="birth" data-placeholder="YY-MM-DD" required></label>
            <div id="emailFill">
                <label>이메일 <input type="text" name="email" id="email" onkeydown="validateEmail()"
                                  placeholder="example@email.com" required></label>
                <button class="--bs-btn-hover-color" id="emailDup" type="button" onclick="checkEmail()">이메일 확인</button>
                <span id="text"></span></div>
            <div id="pwFill">
                <label>비밀번호 <input type="password" name="pw" id="pw" oninput="validatePw()" placeholder="(필수)" required></label>
                <span id="text2"></span></div>
            <br><br>
            <label><input type="checkbox" name="personalInfo" required>개인정보 제 3자 제공동의(필수)
                <span class="link" href=..>내용 읽기</span></label><br>
            <label><input type="checkbox" name="alarm">상품 정보 및 혜택 수신 동의 (선택)
                <span class="link2" href=..>내용 읽기</span></label><br>
            <label><input type="checkbox" name="ageCheck" required>만 14세 미만의 이용자께서는 체크해주세요(필수)</label><br><br>
            <button class="btn-bd-primary" type="button" onclick="submitPage(event)">계속</button>
            <span id="submitError"></span>
        </div>
    </form>
</main>
<script type="text/javascript">
    function submitPage(event) {
	const form = document.getElementById('form');
	const errorMsg = document.getElementById('submitError');
	errorMsg.style.display = 'none';

	if (!form.checkValidity()) {
		errorMsg.innerHTML = '모든 항목을 입력해주세요.';
		errorMsg.style.color = '#ff0000';
		errorMsg.style.display = 'block';
		event.preventDefault();
		return;
	}
	form.submit();
}

document.querySelector('input[name="id"]').addEventListener('keypress', function(event) {
	if (event.key === 'Enter') {
		event.preventDefault();
		checkId();
	}
});

document.querySelector('input[name="email"]').addEventListener('keypress', function(event) {
	if (event.key === 'Enter') {
		event.preventDefault();
		checkEmail();
	}
});
function validateEmail() {
	var form = document.getElementById('form');
	var email = document.getElementById('email').value;
	var text = document.getElementById('text');
	var pattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;
	if (!email.match(pattern)) {
		text.innerHTML = '유효한 이메일 주소를 입력해주세요.';
		text.style.color = '#ff0000';
		text.style.display = 'block';
	} else {
		text.style.display = 'none';
	}
}
const today = new Date().toISOString().split('T')[0];
document.getElementById('birth').setAttribute('min', '1900-01-01');
document.getElementById('birth').setAttribute('max', today);

function checkId() {
	const id = document.querySelector('input[name="id"]').value;
	const message = document.getElementById('text1');
	const idPattern = /^[a-zA-Z0-9]+$/;

	if (id.trim() === "") {
		message.innerHTML = '입력이 필요합니다.';
		message.style.color = '#ff0000';
		message.style.display = 'block';
		return;
	}
	if (!id.match(idPattern)) {
		message.innerHTML = '영문과 숫자 조합만 가능합니다.';
		message.style.color = '#ff0000';
		message.style.display = 'block';
		return;
	}

	fetch(`/checkId?id=${id}`)
		.then(response => response.json())
		.then(data => {
			message.style.display = 'block';
			if (!data.available) {
				message.innerHTML = '아이디가 중복됩니다.';
				message.style.color = '#ff0000';
			} else {
				message.innerHTML = '사용 가능한 아이디입니다.';
				message.style.color = '#B2D055';
			}
		})
		.catch(error => console.error('Error:', error));
}
function checkEmail() {
	const email = document.querySelector('input[name="email"]').value;
	const message = document.getElementById('text');
	var pattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;

	if (!email.match(pattern)) {
		message.innerHTML = '입력이 필요합니다.';
		return;
	}
	fetch(`/checkEmail?email=${email}`)
		.then(response => response.text())
		.then(data => {
			message.style.display = 'block';
			if (data.includes('중복')) {
				message.innerHTML = '이메일이 중복됩니다.';
				message.style.color = '#ff0000';
			} else {
				message.innerHTML = '사용 가능한 이메일입니다.';
				message.style.color = '#B2D055';
			}
		})
		.catch(error => console.error('Error:', error));
}
function validatePw() {
	const passwordInput = document.getElementById('pw');
	const message = document.getElementById('text2');
	const pwPattern = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{8,20}$/;

	passwordInput.addEventListener('input', function(event) {
		const password = passwordInput.value;

		if (!password.match(pwPattern)) {
			message.style.display = 'block';
			message.innerHTML = '비밀번호는 8-20자 이내의 영문, 숫자, 혹은 특수문자를 포함해야 합니다.';
			message.style.color = '#ff0000';
		} else {
			message.style.display = 'none';
		}
	});
}
validatePw();
</script>
</body>
</html>